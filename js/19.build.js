(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{114:function(t,e,o){var s=o(224);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,o(0).default)("432683f4",s,!1,{})},115:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])}return t};e.default={components:{Casing:()=>Promise.resolve().then(o.bind(null,175)),Icon:()=>o.e(5).then(o.bind(null,93))},computed:s({canvas(){return this.$store.state.canvas},c(){return this.$store.state.canvas.c}},Vuex.mapState(["activeTool"])),mounted(){bus.$on("toolEventActive",this.active);let t={preferredFormat:"name",showInput:!0,showButtons:!1,showAlpha:!0};$(this.$refs.foreground).spectrum(s({color:"black",replacerClassName:"common-tools__foreground-replacer common-tools__colorpicker-replacer"},t)),$(this.$refs.foreground).on("dragstop.spectrum",t=>{this.updateColor($(this.$refs.foreground).spectrum("get"))}),$(this.$refs.background).spectrum(s({color:"white",replacerClassName:"common-tools__background-replacer common-tools__colorpicker-replacer"},t))},methods:{active(t){this.generator&&this.generator.next(),t&&(this.$store.state.activeTool=t,this.updateColor($(this.$refs.foreground).spectrum("get"))),this.canvas&&this.activeTool&&(this.generator=this[this.activeTool](),this.generator.next())},updateColor(t){let e,o=this.activeTool;e="pencil"===o||"brush"===o||"line"===o?"stroke":"fill",this.$store.commit({type:"propUpdate",tool:"global",setting:e,newValue:tinycolor(t).toRgbString(),onlyGlobal:!0})},swapColor(){let t=$(this.$refs.foreground).spectrum("get");$(this.$refs.foreground).spectrum("set",$(this.$refs.background).spectrum("get")),$(this.$refs.background).spectrum("set",t),this.updateColor($(this.$refs.foreground).spectrum("get"))},add(t,e){let o;if(this.canvas.activeLayer&&"empty"===this.canvas.activeLayer.type)return this.canvas.activeLayer.group.addWithUpdate(t),this.canvas.activeLayer.object=t,this.canvas.activeLayer.type=e,void this.c.remove(t);(o=new fabric.Group([t],{hasControls:!1})).layer=!0,o.type=e,this.c.add(o),this.c.remove(t)},move:function*(){let t=this.canvas;t.c.selection=!0,t.c.skipTargetFind=!1,t.c.setActiveObject(t.activeLayer.group),t.c.forEachObject(t=>{t.hasControls=!0,t.set({cornerStrokeColor:"white",cornerStyle:"circle",cornerSize:5,transparentCorners:!1})}),t.c.requestRenderAll(),yield,t.c.skipTargetFind=!0,t.c.selection=!1,t.c.forEachObject(t=>{t.hasControls=!1}),t.c.setActiveObject(t.activeLayer.group),t.c.requestRenderAll()},pencil:function*(){let t,e,o,s,n,a,r=this.canvas;r.c.defaultCursor="none",o=(t=>{let e,o,s,n,{x:c,y:i}=r.c.getPointer(),{x:l,y:u}=r.c.getPointer(null,!0);e=o=this.$store.state.pencil.strokeWidth,s=(n=r.c.getContext().getImageData(l+e/2,u+o/2,1,1)).data[0]<50&&n.data[1]<50&&n.data[2]<50?"white":"black",r.c.remove(a),a=new fabric.Rect({left:c-1,top:i-1,width:e+1,height:o+1,fill:"transparent",stroke:s,strokeWidth:1}),r.c.add(a)}),r.c.on("mouse:move",o),r.c.on("mouse:out",()=>{r.c.remove(a)}),r.c.on("mouse:down",t=(t=>{let{x:a,y:c}=r.c.getPointer(),i=0;n=new fabric.Path(`M ${a} ${c} L ${a+.1} ${c}`,Object.assign({},this.$store.state.global,this.$store.state.pencil,{strokeLineCap:"square",strokeLineJoin:"bevil"})),r.c.add(n),o(),r.c.on("mouse:move",e=(t=>{let{x:e,y:s}=r.c.getPointer();i||(n.path.pop(),i++),r.c.remove(n),n.path.push(["L",e,s]),n=new fabric.Path(n.path,Object.assign({},this.$store.state.global,this.$store.state.pencil,{strokeLineCap:"square",strokeLineJoin:"bevil"})),r.c.add(n),o()})),r.c.on("mouse:up",s=(t=>{this.add(n,"pencil"),r.c.off("mouse:move",e),r.c.off("mouse:up",s),o()}))})),yield,r.c.off("mouse:down",t),r.c.off("mouse:move",o),r.c.defaultCursor="default"},brush:function*(){let t,e,o,s,n,a,r=this.canvas;r.c.defaultCursor="none",o=(t=>{let{x:e,y:o}=r.c.getPointer();r.c.remove(a),a=new fabric.Circle({left:e-1,top:o-1,radius:this.$store.state.pencil.strokeWidth/2+.5,fill:"transparent",stroke:"black",strokeWidth:1,shadow:"rgba(255,255,255,1) 0 0 1px"}),r.c.add(a)}),r.c.on("mouse:move",o),r.c.on("mouse:out",()=>{r.c.remove(a)}),r.c.on("mouse:down",t=(t=>{let{x:a,y:c}=r.c.getPointer(),i=0;n=new fabric.Path(`M ${a} ${c} L ${a+.1} ${c}`,Object.assign({},this.$store.state.global,this.$store.state.pencil,{strokeLineCap:"round",strokeLineJoin:"round"})),r.c.add(n),o(),r.c.on("mouse:move",e=(t=>{let{x:e,y:s}=r.c.getPointer();i||(n.path.pop(),i++),r.c.remove(n),n.path.push(["L",e,s]),n=new fabric.Path(n.path,Object.assign({},this.$store.state.global,this.$store.state.pencil,{strokeLineCap:"round",strokeLineJoin:"round"})),r.c.add(n),o()})),r.c.on("mouse:up",s=(t=>{this.add(n,"brush"),r.c.off("mouse:move",e),r.c.off("mouse:up",s),o()}))})),yield,r.c.off("mouse:down",t),r.c.off("mouse:move",o),r.c.defaultCursor="default"},path:function*(){let t,e,o,s,n,a,r=this.canvas;r.c.on("mouse:down",s=(s=>{if(s.e.ctrlKey)return r.c.remove(t),t.path.pop(),r.c.add(new fabric.Path(t.path,{strokeWidth:20,stroke:"black",fill:"transparent"})),t=void 0,void r.c.off("mouse:move",n);r.c.off("mouse:move",n);let{x:c,y:i}=r.c.getPointer();e=c,o=i,t||(t=new fabric.Path(`M ${c} ${i}`,{strokeWidth:20,stroke:"black",fill:"transparent"})),r.c.remove(t),t.path.push(["Q",c,i,c,i]),t=new fabric.Path(t.path,{strokeWidth:20,stroke:"black",fill:"transparent"}),r.c.add(t),console.log(t),r.c.on("mouse:move",n=(e=>{console.log("move");let{x:o,y:s}=r.c.getPointer();r.c.remove(t),t.path[t.path.length-2][1]=o,t.path[t.path.length-2][2]=s,t=new fabric.Path(t.path,{strokeWidth:20,stroke:"black",fill:"transparent"}),r.c.add(t)})),r.c.on("mouse:up",a=(e=>{r.c.off("mouse:move",n),r.c.off("mouse:up",a),r.c.on("mouse:move",n=(e=>{let{x:o,y:s}=r.c.getPointer();r.c.remove(t),_.last(t.path)[3]=o,_.last(t.path)[4]=s,t=new fabric.Path(t.path,{strokeWidth:20,stroke:"black",fill:"transparent"}),r.c.add(t)}))}))})),yield,r.c.off("mouse:down",s)},text:function*(){let t,e,o,s=this.canvas;s.c.on("mouse:up",e=(e=>{let{x:n,y:a}=s.c.getPointer();t&&t.exitEditing(),Object.assign(this.$store.state.text,{left:n,top:a}),t=new fabric.IText("",this.$store.state.text),o=new fabric.Group([t]),t.on("changed",()=>o.addWithUpdate()),o.type="text",s.c.add(o),t.enterEditing()})),yield,t&&t.exitEditing(),s.c.off("mouse:up",e)},pouring:function*(){let t,e=this.canvas;e.c.on("mouse:up",t=(t=>{if(1===t.button||3===t.button){let o,s,n,a,r,{x:c,y:i}=e.c.getPointer();s=1===t.button?$(this.$refs.foreground).spectrum("get").toRgbString():$(this.$refs.background).spectrum("get").toRgbString();for(let t of e.c.getObjects().slice().reverse())if(t.containsPoint({x:c,y:i})&&!e.c.isTargetTransparent(t,c,i)){o=e.c.getPixel(),a=tinycolor(t.object.fill).toRgb(),r=tinycolor(t.object.stroke).toRgb(),n=_.isEqual(o,a)?"fill":_.isEqual(o,r)?"stroke":0===a.a?"stroke":"fill",t.object.set(n,s),e.c.requestRenderAll();break}}})),yield,e.c.off("mouse:up",t)},eraser:function*(){let t,e,o,s,n,a,r=this.canvas;r.c.defaultCursor="none",o=(t=>{let{x:e,y:o}=r.c.getPointer();r.c.remove(a),a=new fabric.Circle({left:e,top:o,radius:this.$store.state.pencil.strokeWidth/2,fill:"transparent",stroke:"grey"}),r.c.add(a)}),r.c.on("mouse:move",o),r.c.on("mouse:out",()=>{r.c.remove(a)}),r.c.on("mouse:down",t=(t=>{let{x:a,y:c}=r.c.getPointer(),i=0;n=new fabric.Path(`M ${a} ${c} L ${a+.1} ${c}`,Object.assign({},this.$store.state.pencil,{fill:"transparent",stroke:"black",globalCompositeOperation:"destination-out"})),console.log(n),r.activeLayer.group.addWithUpdate(n),o(),r.c.on("mouse:move",e=(t=>{let{x:e,y:s}=r.c.getPointer();i||(n.path.pop(),i++),r.activeLayer.group.remove(n),n.path.push(["L",e,s]),n=new fabric.Path(n.path,Object.assign({},this.$store.state.pencil,{fill:"transparent",stroke:"black",globalCompositeOperation:"destination-out"})),r.activeLayer.group.addWithUpdate(n),o()})),r.c.on("mouse:up",s=(t=>{r.c.off("mouse:move",e),r.c.off("mouse:up",s),o()}))})),yield,r.c.off("mouse:down",t),r.c.off("mouse:move",o),r.c.defaultCursor="default"},square:function*(){let t,e,o,s,n=this.canvas;n.c.on("mouse:down",e=(e=>{let{x:a,y:r}=n.c.getPointer();s=new fabric.Rect(Object.assign({},this.$store.state.global,this.$store.state.square,{left:a,top:r})),n.c.add(s),n.c.on("mouse:move",o=(t=>{let{x:e,y:o}=n.c.getPointer(),c=Math.abs(e-a),i=Math.abs(o-r);e<a&&o<r?(s.scaleX=-1,s.scaleY=-1):e<a?(s.scaleX=-1,s.scaleY=1):o<r?(s.scaleY=-1,s.scaleX=1):(s.scaleX=1,s.scaleY=1),s.set({width:c,height:i}),console.log(s.left,s.top,s.width,s.height),n.c.requestRenderAll()})),n.c.on("mouse:up",t=(e=>{this.add(s,"square"),n.c.off("mouse:move",o),n.c.off("mouse:up",t)}))})),yield,n.c.off("mouse:down",e)},line:function*(){let t,e,o,s,n=this.canvas;n.c.on("mouse:down",t=(t=>{let{x:a,y:r}=n.c.getPointer();s=new fabric.Line([a,r,a,r],Object.assign({},this.$store.state.global,{strokeWidth:1,stroke:"black"})),n.c.add(s),n.c.on("mouse:move",e=(t=>{({x:a,y:r}=n.c.getPointer()),s.set({x2:a,y2:r}),n.c.requestRenderAll()})),n.c.on("mouse:up",o=(t=>{this.add(s,"lines"),n.c.off("mouse:move",e),n.c.off("mouse:up",o)}))})),yield,n.c.off("mouse:down",t)},zoomIn:function*(){let t,e=this.canvas;e.c.on("mouse:up",t=(t=>{this.$store.commit({type:"setZoom",zoom:e.zoom+.2,point:e.c.getPointer()})})),yield,e.c.off("mouse:up",t)},zoomOut:function*(){let t,e=this.canvas;e.c.on("mouse:up",t=(t=>{this.$store.commit({type:"setZoom",zoom:e.zoom-.2,point:e.c.getPointer()})})),yield,e.c.off("mouse:up",t)}},updated(){},data:()=>({tools:["move","pencil","brush","path","text","pouring","eraser","square","line","zoomIn","zoomOut"],generator:null})}},116:function(t,e,o){"use strict";o.r(e);var s=o(115),n=o.n(s);for(var a in s)"default"!==a&&function(t){o.d(e,t,function(){return s[t]})}(a);e.default=n.a},196:function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"tools-wrapper tools"},[t._l(t.tools,function(e,s){return o("div",{key:s,class:[{active:t.activeTool===e},"tool","bg-anim-icon"],on:{click:function(o){t.active(e)}}},[o("Icon",{attrs:{icon:e}})],1)}),t._v(" "),o("div",{staticClass:"tool swap-color"},[o("input",{ref:"foreground",attrs:{type:"text"}}),t._v(" "),o("input",{ref:"background",attrs:{type:"text"}}),t._v(" "),o("div",{staticClass:"swap-color__icon",on:{click:t.swapColor}},[o("Icon",{attrs:{icon:"swap-color"}})],1)])],2)},n=[];s._withStripped=!0,o.d(e,"a",function(){return s}),o.d(e,"b",function(){return n})},224:function(t,e,o){(t.exports=o(1)(!1)).push([t.i,"\n.tools-wrapper[data-v-674b1a59] {\n  flex-shrink: 0;\n  z-index: 1000;\n  background: var(--main-color);\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-content: flex-start;\n  width: 40px;\n  transition: opacity .8s;\n}\n.tool[data-v-674b1a59] {\n  width: 100%;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n}\n.tool svg[data-v-674b1a59] {\n    width: 19px;\n    height: 19px;\n}\n.tool.active[data-v-674b1a59] {\n  background: var(--bg-color);\n}\n.swap-color[data-v-674b1a59] {\n  position: relative;\n}\n.swap-color__icon[data-v-674b1a59] {\n    width: 10px;\n    height: 10px;\n    position: absolute;\n    right: 10%;\n    top: 10%;\n    display: flex;\n    transform: rotate(90deg);\n}\n.swap-color__icon svg[data-v-674b1a59] {\n      width: 100%;\n      height: 100%;\n}\n",""])},225:function(t,e,o){"use strict";var s=o(114);o.n(s).a},226:function(t,e,o){"use strict";o.r(e);var s=o(196),n=o(116);for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);o(225);var r=o(2),c=Object(r.a)(n.default,s.a,s.b,!1,null,"674b1a59",null);c.options.__file="src/js/components/tools/common-tools.vue",e.default=c.exports}}]);