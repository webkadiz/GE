{"version":3,"sources":["webpack:///src/js/components/canvas.vue","webpack:///./src/js/components/canvas.vue?e639","webpack:///./src/js/components/canvas.vue?dd15","webpack:///./src/js/components/canvas.vue?557c","webpack:///./src/js/components/canvas.vue","webpack:///./src/js/components/canvas.vue?3e3e","webpack:///./src/js/components/canvas.vue?b3e4"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA;;;;0KAIA;AAFA;AAGA,wCACA,+CAEA;;YAEA;kDACA;AACA;aACA;mDACA;AAEA;;WACA;;2BAEA;4BACA;qBAGA;AALA;;;eAOA;gBAEA;AAHA;AAIA;kBACA;4EAGA;AAFA;0EAKA;AAFA;0EAKA;AAFA;4EAOA;AAJA;;gCAKA;;4BAEA;gBAEA;AAHA;iBAIA;sBACA;sBACA;aAEA;;;2BAEA;4BACA;0BAEA;AAJA;;oBAMA;qBACA;oBACA;uBACA;uBACA;qBACA;qBAEA;AARA;mBAUA;;iBACA;YAEA;;4BACA;kDACA;mBACA;cACA;eACA;AACA;AACA;iBACA;uBACA;UACA;UACA;UACA;UACA;kCAEA;;kCAEA;;mCAEA;;4BACA;4BACA;2FACA;AAEA;AAvFA;YAwFA;4CACA;qBAEA;;;kBAEA;mBACA;sBACA;iBACA;8BACA;sBACA;uBACA;mBACA;uBAEA;AAVA;+BAYA;;AACA;AACA;AAGA;;;wCACA;8BACA;qFAEA;AACA;AACA;wCACA;8BACA;qFACA;AACA;AAGA;;wCACA;qBACA;AACA;AACA;AAEA;;mCACA;AACA;;;;UAEA;;wCACA;oDACA;eACA;2CACA;yDACA;eACA;0CACA;yDACA;eACA;yCACA;sDACA;eACA;2CACA;8DACA;eACA;0CACA;sDACA;eACA;0CACA;uDACA;eACA;AAEA;;gBACA;0GACA;gCACA;kCACA;qCACA;eACA;AACA;AACA;sCAEA;;AACA;iCACA;8BACA;yCAEA;;uBACA;uBAEA;;4CACA;uDACA;uDACA;iBACA;yBACA;yBACA;AAEA;;wCACA;mCACA;iCACA;AACA;AACA;AAEA;;SACA;SAEA;;AAEA;;yDAEA;;mDACA;kDACA;4CACA;kEACA;uBACA;yCACA;yCAEA;;+EACA;iCACA;AACA;mDACA;oDACA;2CACA;mEACA;uBACA;wCACA;yCAEA;;6EACA;gCACA;AAEA;;YAEA;;kCACA;AACA;SACA;;iBAEA;kBAEA;AAHA;AAIA;AA5OA,E;;;;;;;;;;;ACbA;AACA;;;AAGA;AACA,4CAA6C,YAAY,uBAAuB,qBAAqB,GAAG,yCAAyC,yBAAyB,4BAA4B,GAAG,qBAAqB,eAAe,cAAc,GAAG,wCAAwC,qBAAqB,sBAAsB,kBAAkB,uBAAuB,YAAY,WAAW,gBAAgB,iBAAiB,gBAAgB,gCAAgC,6BAA6B,GAAG,4DAA4D,+BAA+B,oBAAoB,GAAG,oEAAoE,uBAAuB,qBAAqB,yBAAyB,mDAAmD,GAAG,qBAAqB,yBAAyB,uBAAuB,gBAAgB,2BAA2B,YAAY,WAAW,iBAAiB,gBAAgB,GAAG,mCAAmC,qBAAqB,4BAA4B,yBAAyB,gDAAgD,kBAAkB,GAAG;;AAEhpC;;;;;;;;;;;;;;;ACPA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,gCAAgC;AACrC;AACA,0BAA0B,SAAS,gCAAgC,EAAE;AACrE;AACA,0BAA0B,SAAS,kCAAkC,EAAE;AACvE;AACA,oBAAoB,iDAAiD;AACrE;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C;AACA,Y;;;;;;;;;;;;;;;;;;ACVkC;AAClC;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,uBAiBA;AACA;AACA,gF;;;;;;;;;;;;;;;;ACvC2K,2OAAoB,C;;;;;;;;;;;;;;;;ACAyJ,2XAAoB,C","file":"js/19.build.js","sourcesContent":["<template>\n  <div class=\"canvas-wrapper\">\n\n    <CanvasCoords :top=\"scrollTop\" axis=\"x\"></CanvasCoords>\n    <CanvasCoords :left=\"scrollLeft\" axis=\"y\"></CanvasCoords>\n\n    <canvas class=\"no-invert canvas\" ref=\"canvas\"></canvas>\n    \n  </div>\t\n</template>\n\n<script>\nexport default {\n  components: {\n    CanvasCoords: () => import(\"./canvas-coords.vue\")\n  },\n  computed: {\n    ...Vuex.mapState([\"canvas\"]),\n    ...Vuex.mapGetters([\"getCanvasWidth\", \"getCanvasHeight\"])\n  },\n  methods: {\n    width() {\n      if (this.$el) return this.$el.clientWidth - 20;\n    },\n    height() {\n      if (this.$el) return this.$el.clientHeight - 20;\n    },\n\n    init() {\n      let rectTransparent = new fabric.Rect({\n        width: this.canvas.width,\n        height: this.canvas.height,\n        strokeWidth: 0\n      });\n\n      let transparent = new fabric.StaticCanvas(document.createElement(\"canvas\"), {\n        width: 10,\n        height: 10\n      });\n      //prettier-ignore\n      transparent.add(\n        new fabric.Rect({\n          left: 0, top: 0, width: 5, height: 5, fill: '#e2e2e2', strokeWidth: 0\n        }),\n        new fabric.Rect({\n          left: 5, top: 0, width: 5, height: 5, fill: 'white', strokeWidth: 0\n        }),\n        new fabric.Rect({\n          left: 0, top: 5, width: 5, height: 5, fill: 'white', strokeWidth: 0\n        }),\n        new fabric.Rect({\n          left: 5, top:5, width: 5, height: 5, fill: '#e2e2e2', strokeWidth: 0\n        })     \n      )\n\n      this.canvas.transparent = transparent;\n      rectTransparent.setPatternFill({\n        source: transparent.getElement(),\n        repeat: \"repeat\"\n      });\n      this.c.add(rectTransparent);\n      rectTransparent.center();\n      rectTransparent.sendToBack();\n      this.c.requestRenderAll();\n\n      let background = new fabric.Rect({\n        width: this.canvas.width,\n        height: this.canvas.height,\n        fill: this.canvas.background\n      });\n      let group = (this.canvas.background = new fabric.Group([background], {\n        selectable: false,\n        hasControls: false,\n        hasBorders: false,\n        lockMovementX: true,\n        lockMovementY: true,\n        hoverCursor: \"default\",\n        strokeWidth: 0\n      }));\n      group.type = \"background\";\n\n      this.c.add(group);\n      group.center();\n\n      if (this.canvas.file) {\n        let group = new fabric.Group([this.canvas.file]);\n        this.c.add(group);\n        group.center();\n        this.c.requestRenderAll();\n      }\n    },\n    updateSize() {\n      let vpt = this.c.viewportTransform,\n        top,\n        left,\n        bottom,\n        right;\n      let bounds = this.c.item(0).getBoundingRect();\n\n      top = vpt[5] + 200 - bounds.top;\n\n      left = vpt[4] + 200 - bounds.left;\n\n      bottom = top - bounds.height;\n      right = left - bounds.width;\n      this.canvas.bounds = { top, bottom, left, right, width: bounds.width, height: bounds.height };\n    }\n  },\n  mounted() {\n    bus.$on(\"updateSize\", this.updateSize); // app.js setZoom\n    let counter = 1; //счетчик слоев\n\n    this.canvas.c = this.c = new fabric.Canvas(this.$refs.canvas, {\n      width: this.getCanvasWidth,\n      height: this.getCanvasHeight,\n      skipTargetFind: true,\n      selection: false,\n      preserveObjectStacking: true,\n      fireRightClick: true,\n      fireMiddleClick: true,\n      centeredKey: \"ctrlKey\",\n      altSelectionKey: \"ctrlKey\"\n    });\n    this.canvas.wrapper = this.$el;\n\n    // this.c.on('object:modified', e => {\n    // \tconsole.log(e);\n    // })\n    \n\n    this.c.on(\"selection:created\", e => {\n      if(!e.target.unactive) {\n        this.canvas.activeLayer = this.canvas.layers.find(layer => layer.group === e.target);\n        \n      }\n    });\n    this.c.on(\"selection:updated\", e => {\n      if(!e.target.unactive) {\n        this.canvas.activeLayer = this.canvas.layers.find(layer => layer.group === e.target);\n      }\n    });\n\n  \n    this.c.on(\"selection:cleared\", e => {\n      console.log(e, 'selection cleared');\n      //console.log('cleared');\n      //this.canvas.activeLayer = null;\n    });\n\n    this.c.on(\"object:added\", e => {\n      //prettier-ignore\n      let target = e.target, flag = false, title, layer;\n\n      if (target.type === \"background\") {\n        title = `Фон ${this.canvas.layers.length + 1}`;\n        flag = true\n      } else if (target.type === \"pencil\") {\n        title = `Карандаш ${this.canvas.layers.length + 1}`;\n        flag = true\n      } else if (target.type === \"brush\") {\n        title = `Карандаш ${this.canvas.layers.length + 1}`;\n        flag = true\n      } else if (target.type === \"text\") {\n        title = `Текст ${this.canvas.layers.length + 1}`;\n        flag = true\n      } else if (target.type === \"square\") {\n        title = `Прямоугольник ${this.canvas.layers.length + 1}`;\n        flag = true\n      } else if (target.type === \"lines\") {\n        title = `Линия ${this.canvas.layers.length + 1}`;\n        flag = true\n      } else if (target.type === \"empty\") {\n        title = `Пустой ${this.canvas.layers.length + 1}`;\n        flag = true\n      }\n\n      if(flag) {\n        layer = { object: target.object, type: target.type, group: target,title, id: counter++, visible: true };\n        this.canvas.layers.push(layer);\n        this.canvas.activeLayer = layer;\n        this.c.setActiveObject(layer.group)\n        this.c.requestRenderAll()\n      }\n    });\n    this.c.on(\"object:removed\", e => {});\n\n    //prettier-ignore\n    this.c.on('mouse:down', e => {\n      let move, up, lastPosX, lastPosY;\n      if(e.e.ctrlKey && e.button === 3) {\n\n        lastPosX = e.e.clientX;\n        lastPosY = e.e.clientY;\n\n        this.c.on('mouse:move', move = e => {\n          this.c.viewportTransform[4] += e.e.clientX - lastPosX;\n          this.c.viewportTransform[5] += e.e.clientY - lastPosY;\n          this.c.requestRenderAll();\n          lastPosX = e.e.clientX;\n          lastPosY = e.e.clientY;\n        })\n\n        this.c.on('mouse:up', up = e => {\n          this.c.off('mouse:move', move)\n          this.c.off('mouse:up', up)\n        })\n      }\n    })\n\n    this.init();\n    this.updateSize();\n\n    //$(this.canvas.c.wrapperEl).css({left: 20, top: 20 });\n\n    this.ps = this.canvas.ps = new PerfectScrollbar(this.$el);\n\n    this.$el.addEventListener(\"ps-scroll-x\", () => {\n      let width = this.$el.scrollWidth - this.$el.clientWidth;\n      let perScroll = this.$el.scrollLeft / width;\n      let perCanvas = perScroll * this.canvas.width * this.canvas.zoom;\n      let vpt = this.c.viewportTransform;\n      vpt[4] = this.canvas.bounds.left - perCanvas;\n      this.canvas.c.setViewportTransform(vpt);\n\n      this.canvas.c.wrapperEl.style.left = this.$el.scrollLeft + COORDS_SIZE + \"px\";\n      this.scrollLeft = this.$el.scrollLeft;\n    });\n    this.$el.addEventListener(\"ps-scroll-y\", () => {\n      let height = this.$el.scrollHeight - this.$el.clientHeight;\n      let perScroll = this.$el.scrollTop / height;\n      let perCanvas = perScroll * this.canvas.height * this.canvas.zoom;\n      let vpt = this.c.viewportTransform;\n      vpt[5] = this.canvas.bounds.top - perCanvas;\n      this.canvas.c.setViewportTransform(vpt);\n\n      this.canvas.c.wrapperEl.style.top = this.$el.scrollTop + COORDS_SIZE + \"px\";\n      this.scrollTop = this.$el.scrollTop;\n    });\n\n    this.ps.update();\n\n    bus.$emit(\"toolEventActive\"); // обработчик в common-tools\n  },\n  data() {\n    return {\n      scrollTop: 0,\n      scrollLeft: 0\n    };\n  }\n};\n</script>\n\n<style lang=\"sass\">\n@import 'config-style'\n\n.canvas-wrapper\n  flex: 1\n  position: relative\n  overflow: hidden\n  .canvas-wrapper-inner\n    position: absolute\n    display: inline-block\n\n.canvas-container\n  left: 20px\n  top: 20px\n\n// .lower-canvas\n//   background-image: url(data:image/gif;base64,R0lGODlhCgAKAIAAAOLi4v///yH5BAAHAP8ALAAAAAAKAAoAAAIRhB2ZhxoM3GMSykqd1VltzxQAOw==)\n\n\n.coords-x-wrapper\n\tfont-size: .7rem\n\tline-height: 30px\n\tdisplay: flex\n\tposition: absolute\n\tleft: 0\n\ttop: 0\n\tz-index: 20\n\theight: 20px\n\twidth: 100%\n\tbackground: var(--bg-color)\n\tcolor: var(--text-color)\n\t.coords-x\n\t\twidth: calc(100% - 20px)\n\t\tdisplay: flex\n\t\tdiv\n\t\t\tflex-shrink: 0\n\t\t\theight: 20px\n\t\t\ttext-indent: 2px\n\t\t\t+bl()\n.coords-y-wrapper\n\t@extend .coords-x-wrapper\n\tline-height: inherit\n\tposition: absolute\n\tz-index: 10 \n\tflex-direction: column\n\tleft: 0\n\ttop: 0\n\theight: 100%\n\twidth: 20px\t\n\t.coords-y\n\t\tdiv\n\t\t\tflex-shrink: 0\n\t\t\twhite-space: pre-wrap\n\t\t\ttext-align: center\n\t\t\t+bt()\n\t\t\twidth: 20px\n\n</style>\n","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"\\n.canvas-wrapper {\\n  flex: 1;\\n  position: relative;\\n  overflow: hidden;\\n}\\n.canvas-wrapper .canvas-wrapper-inner {\\n    position: absolute;\\n    display: inline-block;\\n}\\n.canvas-container {\\n  left: 20px;\\n  top: 20px;\\n}\\n.coords-x-wrapper, .coords-y-wrapper {\\n  font-size: .7rem;\\n  line-height: 30px;\\n  display: flex;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 20;\\n  height: 20px;\\n  width: 100%;\\n  background: var(--bg-color);\\n  color: var(--text-color);\\n}\\n.coords-x-wrapper .coords-x, .coords-y-wrapper .coords-x {\\n    width: calc(100% - 20px);\\n    display: flex;\\n}\\n.coords-x-wrapper .coords-x div, .coords-y-wrapper .coords-x div {\\n      flex-shrink: 0;\\n      height: 20px;\\n      text-indent: 2px;\\n      border-left: 1px solid var(--border-color);\\n}\\n.coords-y-wrapper {\\n  line-height: inherit;\\n  position: absolute;\\n  z-index: 10;\\n  flex-direction: column;\\n  left: 0;\\n  top: 0;\\n  height: 100%;\\n  width: 20px;\\n}\\n.coords-y-wrapper .coords-y div {\\n    flex-shrink: 0;\\n    white-space: pre-wrap;\\n    text-align: center;\\n    border-top: 1px solid var(--border-color);\\n    width: 20px;\\n}\\n\", \"\"]);\n\n// exports\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    { staticClass: \"canvas-wrapper\" },\n    [\n      _c(\"CanvasCoords\", { attrs: { top: _vm.scrollTop, axis: \"x\" } }),\n      _vm._v(\" \"),\n      _c(\"CanvasCoords\", { attrs: { left: _vm.scrollLeft, axis: \"y\" } }),\n      _vm._v(\" \"),\n      _c(\"canvas\", { ref: \"canvas\", staticClass: \"no-invert canvas\" })\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"26102f7e\", content, false, {});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\", function() {\n     var newContent = require(\"!!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\");\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","import { render, staticRenderFns } from \"./canvas.vue?vue&type=template&id=06145104\"\nimport script from \"./canvas.vue?vue&type=script&lang=js\"\nexport * from \"./canvas.vue?vue&type=script&lang=js\"\nimport style0 from \"./canvas.vue?vue&type=style&index=0&lang=sass\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/home/webkadiz/Projects/current/GE/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('06145104', component.options)\n    } else {\n      api.reload('06145104', component.options)\n    }\n    module.hot.accept(\"./canvas.vue?vue&type=template&id=06145104\", function () {\n      api.rerender('06145104', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/js/components/canvas.vue\"\nexport default component.exports","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=script&lang=js\"","import mod from \"-!../../../node_modules/vue-style-loader/index.js!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\"; export default mod; export * from \"-!../../../node_modules/vue-style-loader/index.js!../../../node_modules/css-loader/index.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./canvas.vue?vue&type=style&index=0&lang=sass\""],"sourceRoot":""}